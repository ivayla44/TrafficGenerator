# TrafficGenerator
Diploma project 2023/2024
--------------------------

Линк към документация на дипломния проект: [Documentation]([url](https://docs.google.com/document/d/1MA7QZc3DwFl5SL4exH2MynIlq706Vmhw51Ps8Y13oTk/edit?usp=sharing))

ГЛАВА IV. РЪКОВОДСТВО ЗА ПОТРЕБИТЕЛЯ
------------------------------------

4.1 Устройство за изграждане на проект
За изграждане на DPDK апликацията са нужни следните системни изисквания, посочени в DPDK документацита специфично за Linux дистрибуции.


4.1.1 Изисквания към устройството
Общи инструменти за разработка - компилатор на C, поддържащ стандарта C11, включително стандартни атомики, например: GCC (версия 5.0+) или Clang (версия 3.6+), както и “pkg-config” или “pkgconf” (програма, която помага да се конфигурират флаговете на компилатора и линкера за библиотеки и frameworks), които да се използват при изграждане на бинарни файлове за крайни потребители с DPDK.

$ apt install build-essential - Ubuntu / Debian

$ dnf groupinstall "Development Tools" - RHEL / Fedora

$ apk add alpine-sdk bsd-compat-headers - Alpine Linux

------------------------------------

Python (версия 3.6+)

------------------------------------

Meson (версия 0.53.2+) и Ninja - Meson и Ninja са системи за изграждане на проекти. И двете се използват за изграждането на DPDK проекти, като главният им акцент е върху скоростта. 


За инсталация и/или обновяване на версия:
$ pip3 install meson ninja

------------------------------------


Pyelftools (version 0.22+) - библиотека на Python за обработка и анализ на ELF файлове и DWARF информация за дебъгване.

$ apt install python3-pyelftools - Ubuntu/Debian

$ dnf install python-pyelftools - Fedora

$ pip3 install pyelftools - RHEL / CentOS

$ apk add py3-elftools - Alpine Linux

------------------------------------


Библиотека за поддръжка на NUMA (Non Uniform Memory Access)

$ apt install libnuma-dev - Ubuntu/Debian

$ dnf install numactl-devel - Fedora / RHEL / CentOS

$ apk add numactl-dev - Alpine Linux

------------------------------------


Libpcap библиотека за структури, използвани при обработката на .pcap файлове

$ apt install libpcap-dev - Ubuntu/Debian

$ dnf / yum  install libpcap - Fedora / CentOS

$ apk add libpcap-dev - Alpine Linux

------------------------------------


4.1.2 Изграждане на проект
След успешна инсталация на подходящи версии на всички зависимости може да се премине към изграждане на проекта и получаване на бинарен изходен файл.


Инсталация на Git за клониране на сорс код върху устройството за изграждане на проекта:

$ sudo apt install git-all - Ubuntu/Debian

$ sudo dnf install git-all - Fedora / RHEL /CentOS

$ apk add git - Alpine Linux

------------------------------------

$ git clone https://github.com/ivayla44/TrafficGenerator.git


След клониране на репозиторията се изпълняват следните команди за изграждане на проекта:


$ cd <path-to-repo>

<TrafficGenerator> $ make configure

<TrafficGenerator> $ make


------------------------------------
Навигира се до директорията, в която се намира сорс кодът на проекта. В главната директория, в която се намират “Makefile” и главният “CMakelists.txt” се извиква командата “make configure”, която ще изгради всички зависимости нужни на проекта.
Тази стъпка отнема значително време, тъй като се създава цялостна статична инсталация на DPDK, както и всички други библиотеки, които се инсталират в CMake стъпката на проекта. През хода на инсталацията в терминала на устройството може да се наблюдава прогреса.


След изпълнението на “make configure” се извиква “make” командата, която от зависимостите, инсталирани в предишната стъпка ще създаде изходен изпълним файл от сорс кода на програмата в “/build” с името “traffic-generator”.

------------------------------------

При промяна на някой от сорс файловете на програмата не е нужно да се повтарят всички горепосочени стъпки (само при промяна на някой от CMake файловете, целият проект трябва да се изгради наново.) За преизграждане на проекта от променен сорс код се изпълняват следните стъпки:


<TrafficGenerator> $ make clean

<TrafficGenerator> $ make



Командата “make clean” почиства изходният файл, за да може да бъде изграден наново.
Ако устройството за изграждане на проекта и това за изпълнението му са различни, само изходният бинарен файл е нужно да се пренесе от едното към другото.

------------------------------------
За пренасяне на файл / директория от едно устройство към друго може да се използва SSH (Secure Shell) връзка с машината и “rsync” командата.

SSH е мрежов протокол, който дава на потребителите сигурен начин за достъп до компютър през мрежа. 

 $ ssh [username]@[host_ip_address]
 
------------------------------------

Rsync е програма за прехвърляне и синхронизиране на файлове между компютри (или компютър и устройство за съхранение) в мрежа чрез сравняване на времето за модификация и размера на файловете.

 $ rsync <path-to-dir> ​​<username>@<remote_host>:<path-to-destination dir>
 
------------------------------------



4.2 Устройство за изпълнение на бинарен файл
За изпълнение на DPDK апликация се изискват персонализирани настройки на целевата машина.

------------------------------------

4.2.1 Изисквания към устройството
Kernel версия >= 4.14 - необходимата версия на ядрото се основава на най-старото дългосрочно стабилно ядро, налично в kernel.org, когато версията на DPDK е в процес на разработка.

 $ uname -r
 
------------------------------------

glibc >= 2.7 - библиотеката GNU C, известна като glibc, е реализацията на стандартната библиотека на езика C от GNU Project. Тя е обвивка около системните извиквания на ядрото на Linux за използване от приложения.

------------------------------------

Конфигурация на Hugepages - Поддръжката на Hugepages е необходима за разпределянето на голям обем памет, използван за буферите на пакети. Чрез използването на разпределенията Hugepage се увеличава производителността, тъй като са необходими по-малко страници и следователно по-малко Translation Lookaside Buffers (TLB, високоскоростни транслационни кешове), които намаляват времето, необходимо за транслиране на адреса на виртуалната страница към адреса на физическата страница. Без "hugepages" при стандартния размер на страницата от 4kB ще се появят високи нива на пропускане на TLB, което ще забави производителността.

------------------------------------

Подходящ драйвер - Повечето устройства изискват хардуерът, който ще се използва от DPDK, да бъде отделен от използвания от него драйвер на ядрото и вместо това да бъде свързан с модула на ядрото “vfio-pci” преди стартирането на приложението. За такива PMD устройства всички мрежови портове или друг хардуер под контрола на Linux ще бъдат игнорирани и няма да могат да бъдат използвани от приложението.

VFIO е надежден драйвер, който разчита на защитата IOMMU. За да се използва VFIO, трябва да се зареди модулът “vfio-pci”. Ядрото VFIO обикновено присъства по подразбиране във всички дистрибуции. (DPDK - “Linux Drivers”)

------------------------------------

4.2.2 Подготовка на устройството
За подмяна на драйвера и настройване на Hugepages и се използва скрипта  “dpdk-setup.sh”, който се намира в “/tools” директорията.

------------------------------------

За да може драйверът на даден интерфейс на машината да бъде подменен с DPDK съвместим драйвер, той първо трябва да се “свали”, така че да стане “невидим” за kernel-а.

 $ ifconfig -a

 $ ip link set down <intrfc-name>

------------------------------------

След успешно изключване на интерфейса може да се извика “dpdk-setup.sh” скриптът, който има три функционалности:

 $ ./dpdk-setup.sh setup - заделя зададения брой Hugepages и подменя драйвера на интерфейса за да може да работи с DPDK

 $ ./dpdk-setup.sh status - показва текущото състояние на устройството - дали има заделени Hugepages и с какви драйвери работят интерфейсите на машината

 $ ./dpdk-setup.sh destroy - освобождава Hugepages паметта и връща оригиналния драйвер на интерфейса


Вътрешно скриптът използва осигурения от DPDK “dpdk-devbind.py” скрипт, който се използва за подмяната на оригиналния Linux драйвер с DPDK съвместимия драйвер.

------------------------------------

Пренасяне на необходими файлове за стартиране на програмата - 
За настройването на машината е нужно да се копира “/tools” директорията, която съдържа нужните скриптове.

------------------------------------

Освен бинарния изпълним файл, машината за изпълнение на програмата трябва да съдържа конфигурационните файлове, както и .pcap файловете, които се използват при изпълнение на програмата. В главния конфигурационен файл трябва да е попълнена информацията за самото устройство, директорията, в която да се търсят .pcap файловете и спецификациите за самата система

